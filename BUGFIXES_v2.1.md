# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–≥–æ–≤ v2.1

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ùå –û—à–∏–±–∫–∞ –≤ –∫–æ–º–∞–Ω–¥–µ `/settings`
**–ü—Ä–æ–±–ª–µ–º–∞**: `BotHandlers._get_text() got multiple values for argument 'language'`

**–ü—Ä–∏—á–∏–Ω–∞**: –í –º–µ—Ç–æ–¥–µ `_handle_settings` –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `language` –¥–≤–∞–∂–¥—ã:
- –ö–∞–∫ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç: `user.language`  
- –ö–∞–∫ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç: `language=language_display`

**–†–µ—à–µ–Ω–∏–µ**:
- –ò–∑–º–µ–Ω–µ–Ω —Ñ–æ—Ä–º–∞—Ç —Ç–µ–∫—Å—Ç–∞ `current_settings` —Å `{language}` –Ω–∞ `{user_language}`
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤: `_get_text("current_settings", language=user.language, user_language=language_display, ...)`
- –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –∫ –æ–±–µ–∏–º —è–∑—ã–∫–æ–≤—ã–º –≤–µ—Ä—Å–∏—è–º (EN/RU)

### 2. üåê –û—à–∏–±–∫–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
**–ü—Ä–æ–±–ª–µ–º–∞**: –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —è–∑—ã–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –≤—ã–∑–æ–≤—ã `_get_text()` –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `language`:
- `_handle_start` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –≤ –±–ª–æ–∫–µ except  
- `_handle_test` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –æ—à–∏–±–æ–∫
- `_handle_menu` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –≤ –±–ª–æ–∫–µ except
- `_handle_settings` - —É–∂–µ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–∞–Ω–µ–µ

### 3. üö´ –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞ `/admin`
**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–º–∞–Ω–¥–∞ `/admin` –Ω–µ –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

**–†–µ—à–µ–Ω–∏–µ**:
- –î–æ–±–∞–≤–ª–µ–Ω —Ö—ç–Ω–¥–ª–µ—Ä –≤ `_register_handlers()`: `CommandHandler("admin", self._handle_admin)`
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `_handle_admin()` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∞–¥–º–∏–Ω—Å–∫–∏—Ö –ø—Ä–∞–≤
- –î–æ–±–∞–≤–ª–µ–Ω —Ç–µ–∫—Å—Ç `admin_help` –≤ `ADMIN_TEXTS` —Å–æ —Å–ø–∏—Å–∫–æ–º –≤—Å–µ—Ö –∞–¥–º–∏–Ω—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥

### 4. üßπ –£–ª—É—á—à–µ–Ω–∞ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –≤ `/stop`
**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–º–∞–Ω–¥–∞ `/stop` –Ω–µ –æ—á–∏—â–∞–ª–∞ –¥–∏–∞–ª–æ–≥ –ø–æ–ª–Ω–æ—Å—Ç—å—é

**–†–µ—à–µ–Ω–∏–µ**:
- –î–æ–±–∞–≤–ª–µ–Ω–æ —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `/stop`
- –î–æ–±–∞–≤–ª–µ–Ω–æ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `remove_user_jobs()` –≤ `YogaScheduler`

## üÜï –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. üóëÔ∏è –ú–µ—Ç–æ–¥ `remove_user_jobs()` –≤ scheduler.py
```python
async def remove_user_jobs(self, chat_id: int) -> int:
    """Remove all scheduled jobs for a specific user."""
    # –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –∑–∞–¥–∞—á–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º user_{chat_id}_
    # –£–¥–∞–ª—è–µ—Ç –∏—Ö –∏–∑ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
```

### 2. üìã –ê–¥–º–∏–Ω—Å–∫–∞—è –∫–æ–º–∞–Ω–¥–∞ `/admin`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞–¥–º–∏–Ω—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥
- –†–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –°–æ–æ–±—â–µ–Ω–∏—è, –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- –¢–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ `ADMIN_IDS`

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ú–µ—Ç–æ–¥ `_get_text()` 
**–§–æ—Ä–º–∞—Ç**: `_get_text(key: str, language: str = "en", **kwargs)`
- `key` - –∫–ª—é—á —Ç–µ–∫—Å—Ç–∞
- `language` - —è–∑—ã–∫ (–∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä)  
- `**kwargs` - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–∑–æ–≤**:
```python
# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
self._get_text("current_settings", language=user.language, user_language=display_lang, time=time)

# ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–¥–≤–æ–π–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ language)  
self._get_text("current_settings", user.language, language=display_lang, time=time)
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å —è–∑—ã–∫–æ–º
**–ü–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è try/except –±–ª–æ–∫–æ–≤**:
```python
except Exception as e:
    logger.error(f"Error in handler for user {chat_id}: {e}")
    # Try to get user language for error message
    try:
        user = await self.storage.get_user(chat_id)
        error_lang = user.language if user else "en"
    except:
        error_lang = "en"
    await update.message.reply_text(self._get_text("error", language=error_lang))
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ö–æ–º–∞–Ω–¥—ã —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- ‚úÖ `/settings` - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –º–µ–Ω—é –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ `/admin` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥
- ‚úÖ `/stop` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–ø–∏—Å—ã–≤–∞–µ—Ç –∏ –æ—á–∏—â–∞–µ—Ç –¥–∏–∞–ª–æ–≥

### –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞:
- ‚úÖ –í—Å–µ –æ—à–∏–±–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ —è–∑—ã–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —É–ª—É—á—à–µ–Ω–∞:
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `/stop` —É–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –æ—á–∏—â–∞–µ—Ç—Å—è –æ—Ç –∑–∞–¥–∞—á –æ—Ç–ø–∏—Å–∞–≤—à–µ–≥–æ—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –î–∏–∞–ª–æ–≥ –æ—Å—Ç–∞–µ—Ç—Å—è —á–∏—Å—Ç—ã–º

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ß—Ç–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å**:
1. `/settings` - –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —è–∑—ã–∫–µ
2. `/admin` - –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
3. `/stop` - –¥–æ–ª–∂–µ–Ω –æ—Ç–ø–∏—Å–∞—Ç—å –∏ –æ—á–∏—Å—Ç–∏—Ç—å –¥–∏–∞–ª–æ–≥  
4. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —è–∑—ã–∫ —Å–æ–æ–±—â–µ–Ω–∏—è

---

*–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: 2025-07-18* 